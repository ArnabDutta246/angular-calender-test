<nav aria-label="breadcrumb">
  <ol class="breadcrumb">
    <li class="breadcrumb-item">
      <a routerLink="/panel/dashboard"><i class="fab fa-houzz mr-1"></i>Dashboard</a>
    </li>
    <li class="breadcrumb-item active-breadcrumb-nav" aria-current="page">
      <i class="fas fa-mug-hot mr-1"></i> User Leave
    </li>
  </ol>
</nav>





<div class="p-lg-3">
<!-- main page row -->
<div class="row">
  <!--============ calender and summery section start ========== -->
  <div class="col-sm-12 col-md-6 col-lg-6">
    <div class="row p-1">
      <div class="col-12 card bg-white">
        <div class="row card-header bg-primary text-white">
          <div class="col-10 align-left" *ngIf="showHidePendingLeaves !== true">{{ switchApplyform !== true ? 'Leave Calendar': 'Apply Leave' }}</div>
          <div class="col-1" *ngIf="showHidePendingLeaves !== true">
            <div class="btn btn-sm btn-primary" (click)="switchApplyform = !switchApplyform" >
              <i class="fas fa-plus" *ngIf="switchApplyform !== true" title="Apply Leave"></i>
              <i class="fas fa-times ml-1" *ngIf="switchApplyform === true" title="Cancel"></i>
            </div>
          </div>
          <div class="col-11" *ngIf="showHidePendingLeaves === true">
            My Leaves
          </div>
          <div class="col-1">
            <div class="btn btn-sm btn-primary" title="Leaves Status" (click)="showHidePendingLeaves = !showHidePendingLeaves">
              <i class="fas fa-bell"></i>
            </div>
          </div>
        </div>
        <!-- =================== normal view (calender view) =============-->
        <div class="card-body" *ngIf="showHidePendingLeaves !== true">
        <!--=============== readonly mood for leave calender =============-->
        <div class="row" *ngIf="switchApplyform !== true">
            <!-- <div class="col-12"> -->
            <ion-calendar
              [readonly]="true"
              [options]="calendarMeta.calendarOptions"
              (monthChange)="monthChanges($event)">
            </ion-calendar>
            <!-- </div> -->
            <!-- <div class="col-12 my-3"> -->
              <div class="col-12 card">
                <div class="card-body">
                  <h6>Leaves Status</h6>
                  <div class="row">
                     <div class="col-4">
                      <div class="row">
                        <div class="col-2">
                          <i class="fas fa-window-minimize text-success"></i>
                        </div>
                        <div class="col-10">
                          <span class="text-muted"><small>Approved</small></span>
                        </div>
                      </div>
                     </div>

                     <div class="col-4">
                      <div class="row">
                        <div class="col-2">
                          <i class="fas fa-window-minimize text-warning"></i>
                        </div>
                        <div class="col-10">
                          <span class="text-muted"><small>Pending</small></span>
                        </div>
                      </div>
                     </div>

                      <div class="col-4">
                      <div class="row">
                        <div class="col-2">
                          <i class="fas fa-window-minimize text-danger"></i>
                        </div>
                        <div class="col-10">
                          <span class="text-muted"><small>Rejected</small></span>
                        </div>
                      </div>
                      </div>

                </div>
              </div>
            </div>
          <!-- </div> -->
        </div>
        <!--=============== readonly mood for leave calender =============-->
        <!--=============== apply leave form ===========================  -->
        <div class="row" *ngIf="switchApplyform === true">
          <div class="col-12">

            <div class="row my-3">
              <div class="col-1">
                <i class="fas fa-mug-hot text-danger"></i>
              </div>
              <div class="col-11">
                Leave Types
              </div>
              <div class="col-12">
                <div class="form-group">
                <select [(ngModel)]="pageObj.apllyingLeave.type" (change)="dayCounter()" class="form-control">
                  <option *ngFor="let data of calendarMeta.allLeavesOrgHave; let i = index" [value]="i">{{data.type}}</option>
                </select>
                </div>
              </div>
            </div>
            <div class="row my-3">
              <div class="col-1">
              <i class="far fa-calendar-alt text-danger"></i>
              </div>
              <div class="col-6">
                Select Date{{toggleMode == 'range' ? 's' : ''}}
              </div>
              <div class="col-5 align-right">
              <div class="calender-toggle-switch">
                <label class="switch">
                  <input type="checkbox" (change)="changeToggleMode()" checked />
                  <span class="slider"></span>
                </label>
              </div>
              </div>
              <div class="col-12">
                <!-- Calendar -->
                <ion-calendar
                #calendar 
                [options]="calendarMeta.calendarOptions" 
                (select)="onSelect($event)"
                (selectStart)="onSelectStart($event)"
                (selectEnd)="onSelectEnd($event)"
                (monthChange)="onMonthChange($event)">
                </ion-calendar>
              </div>
            </div>
            <div class="row my-3">
              <div class="col-1">
              <i class="fas fa-comment-alt text-danger"></i>
              </div>
              <div class="col-11">
                Reason
              </div>
              <div class="col-10">
                <div class="form-group">
                  <input type="text" class="form-control text-primary" placeholder="Note for leave request *"  [(ngModel)]="pageObj.apllyingLeave.reason" name="apply reason">
                </div>
              </div>
              <div class="col-2">
                <div class="btn btn-sm btn-primary">
                  <i class="fas fa-paper-plane" (click)="applyLeave()"></i>
                </div>
              </div>
              <div class="col-12">
                <p>{{pageObj.apllyingLeave.resultDescribe}}</p>
              </div>
            </div>
          </div>
        </div>
        <!--=============== apply leave form ===========================  -->
        </div>
        <!-- =================== normal view (calender view) =============-->
        <!-- =================== leave details view (leave view) =============-->
        <!-- =================== leave details view (leave view) =============-->
      </div>
    </div>
  </div>
  <!--============ calender and summery section end ========== -->
  <!--============ leave summery section start ========== -->
  <div class="col-sm-12 col-md-6 col-lg-6">
    <div class="row p-1">
  <!--============  pending/recent leave section start ========== -->
  <div class="showHidePendingLeaves" *ngIf="showHidePendingLeaves === true">
      <!-- pending/recent leave search card -->
      <div class="col-12 card bg-white mb-2">
        <div class="row card-header">
          Search Here
        </div>
        <div class="card-body">
          <div class="row bg-white">
          <div class="col-11">
                <div class="searchBox">
                  <input type="text" placeholder="Search Here....." class="form-control" [(ngModel)]="searchTexts" />
                </div>
          </div>
          <div class="col-1">
            <button class="btn btn-sm btn-default"><i class="fas fa-search" (click)="getDataOfallSearch()"></i></button> 
          </div>
          </div>
          <div class="row mt-2">
            <div class="col-5">
              <span>Result matching</span>
            </div>
            <div class="col-7">
            <div class="search-toggle-switch">
              <label class="switch">
                <input type="checkbox" (click)="changeSearchMode()" checked />
                <span class="slider"></span>
              </label>
            </div>
            </div>
          </div>
          </div>
      </div>
      <!-- pending/recent leave  search card -->
      <!-- pending/recent leave all cards -->
        <div class="col-12 allBoxes card my-2">
        
          <div class="row card-header pendingBox bg-warning text-white">
            <div class="col-12">
               Pending
            </div>
          </div> 
          <div class="card-body allBoxesAvail">
                <div class="eachBox" *ngFor="let data of pendingData">
                  <div (click)="details(data)">
                    <div class="profile">
                      <img src="{{(data.data.user.picUrl) ? data.data.user.picUrl : '../../../../assets/image/imgs/profile.png'}}"
                        (error)="'../../../../assets/image/imgs/profile.png'" />
                      <div class="moreInfo">
                        <h4>{{data.data.user.name}}</h4>
                        <div class="dates">
                          <img src="../../../../assets/image/imgs/calendar-black.svg" />
                          <p>{{data.startDate}}</p>
                          <img src="../../../../assets/image/imgs/calendar-black.svg" />
                          <p>{{data.endDate}}</p>
                        </div>
                        <div class="days">
                          <p><b>{{data.data.daysCount}}</b> {{(data.data.daysCount>1)?' Days':' Day'}}</p>
                          <p>{{data.appliedAgo}}</p>
                        </div>
                      </div>
                    </div>
                    <div class="reasons">
                      <h5>{{data.data.type}}</h5>
                      <p>{{data.data.reason}}</p>
                    </div>
                  </div>
                </div>
                <div class="noTaskForAdmin" *ngIf="pendingData.length == 0 && (viewMode=='LEAVEADMIN')">
                  <p>There are no leave requests requring your action for the selected region {{selectedCountry}} -
                    {{selectedRegion}}.</p>
                  <img src="../../../../assets/image/imgs/splash_scr4.png" />
                </div>
                <div class="noTaskForAdmin" *ngIf="pendingData.length == 0 && viewMode!='LEAVEADMIN'">
                  <p>There are no pending leave requests submitted by you for approval.</p>
                  <img src="../../../../assets/image/imgs/splash_scr4.png" />
                </div>
        
              </div>
          </div>
          <div class="col-12 allBoxes card my-2">
            <div class="row card-header recentBox bg-success text-white">
              <div class="col-12">
                Recent
              </div>
            </div>
            <div class="card-body allBoxesAvail">
              <div class="eachBox" *ngFor="let data of otherData">
                <div (click)="details(data)">
                  <div class="profile">
                    <div class="state"
                      [ngStyle]="(data.data.status == 'APPROVED') ? {'border-left-color':'rgb(32, 150, 255)'} : {'border-left-color':'rgb(255, 216, 111)'}">
                      <p [class]="'status ' + data.data.status">
                        {{data.data.status}}
                      </p>
                      <div class="reason">
                        <p>{{data.data.type}}</p>
                        <p>{{data.data.reason}}</p>
                      </div>
                    </div>
                    <img [src]="(data.data.user.picUrl) ? data.data.user.picUrl : '../../../../assets/image/imgs/profile.png'"
                      (error)="'../../../../assets/image/imgs/profile.png'" />
                    <div class="positioning">
                      <p>{{data.data.user.name}}</p>
                      <p>{{data.data.user.email}}</p>
                    </div>
                  </div>
                  <p class="noOfdaysAgo">{{data.updatedOn}}</p>
                  <div class="days">
                    <p><b>{{data.data.daysCount}}</b> {{(data.data.daysCount>1)?' Days':' Day'}}</p>
                    <img src="../../../../assets/image/imgs/calendar-black.svg" />
                    <p>{{data.startDate}}</p>
                    <img src="../../../../assets/image/imgs/calendar-black.svg" />
                    <p>{{data.endDate}}</p>
                  </div>
                </div>
              </div>
              <div class="noTaskForAdmin" *ngIf="otherData.length == 0 && (viewMode=='LEAVEADMIN')">
                <p>There are no leave request recently processed for the selected region {{selectedCountry}} -
                  {{selectedRegion}}.</p>
                <img src="../../../../assets/image/imgs/splash_scr4.png" />
              </div>
              <div class="noTaskForAdmin" *ngIf="otherData.length == 0 && viewMode!='LEAVEADMIN'">
                <p>There are no recent leave request created by you.</p>
                <img src="../../../../assets/image/imgs/splash_scr4.png" />
              </div>
            
            </div>
          </div>
      <!-- pemding/recent leave all cards -->
   </div> 
  <!--============  pending/recent leave section end ========== -->

      <div class="col-12 card bg-white">
        <div class="row card-header  bg-primary text-white">
          <div class="col-12">Leave Summary</div>
        </div>
        <!-- <div class="card"> -->
          <div class="card-body" *ngIf="!calendarMeta.userleaveTypes">
            <p class="mb-2 text-danger">No leave summary found. Please contact your leave admin to link your account to a vlaid region using Manage Region option</p>
          </div>
          <div class="card-body" *ngIf="calendarMeta.userleaveTypes">
            <h6 class="mb-2">Your Leave Summary</h6>
            <!-- =========== horizontal bar graph ==============-->
            <div class="summary-data eachRates" *ngFor="let leave of calendarMeta.userleaveTypes; let i=index;">
              <div class="row">
                <div class="col-6">
                  <h6>{{calendarMeta.userCalendarYear.leaveTypes[leave].type}}</h6>
                </div>
                <div class="col-6">
                  <h6>
                    {{calendarMeta.userCalendarYear.leaveTypes[leave].taken ? calendarMeta.userCalendarYear.leaveTypes[leave].taken : 0 }}
                    of {{calendarMeta.userCalendarYear.leaveTypes[leave].allowed}} Taken
                  </h6>
                </div>
                <div class="col-12">
                  <div class="chartrate">
                    <div
                      [ngStyle]="{'background': leaveColors[i%14],'width': calendarMeta.userCalendarYear.leaveTypes[leave].taken ?(calendarMeta.userCalendarYear.leaveTypes[leave].taken * 100 /calendarMeta.userCalendarYear.leaveTypes[leave].allowed)+'%' : '0%'}">
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <!-- =========== horizontal bar graph ==============-->
          </div>
    <!-- </div> -->
      </div>
      <div class="col-12 card bg-white mt-2" *ngIf="showHidePendingLeaves !== true">
        <div class="row card-header bg-primary text-white">
          <div class="col-12">
            Adjoining Leaves
          </div>
        </div>
        <div class="card-body">
            <div class="eachDetails" *ngIf="monthsData.length==0">
              <p class="type" [ngClass]="'moderate'">No Leave Found</p>
              <div class="timings">
                <p class="applied">Yet to apply any leave for the month</p>
                <p class="leavetype">No leave record exist</p>
                <p class="rason">No leave applied for the selected month.</p>
                <div class="days">
                  <span><b>0</b>Day</span>
                  <i class="far fa-calendar-alt mr-2"></i>
                  <span>{{dateFormatting(null,'ll')}}</span>
                <i class="far fa-calendar-alt mr-2"></i>
                  <span>{{dateFormatting(null,'ll')}}</span>
                </div>
              </div>
            </div>
            <div class="eachDetails" (click)="details(data)" *ngFor="let data of monthsData">
              <p class="type" [ngClass]="data.status">{{data.status}}</p>
              <div class="timings">
                <p class="applied">Applied: {{dateFormatting(data.applied.seconds * 1000, 'lll')}}</p>
                <p class="leavetype">{{data.type}}</p>
                <p class="rason">{{data.reason}}</p>
                <div class="days">
                  <span><b>{{data.daysCount}}</b> {{(data.daysCount >  1) ? 'Days' : 'Day'}}</span>
                  <i class="far fa-calendar-alt mr-2"></i>
                  <span>{{dateFormatting(data.startDate.seconds * 1000,'ll')}}</span>
                  <i class="far fa-calendar-alt mr-2"></i>
                  <span>{{dateFormatting(data.endDate.seconds * 1000,'ll')}}</span>
                </div>
              </div>
            </div>
        </div>
      </div>
    </div>
  </div>
  <!--============ leave summery section end ========== -->
</div>

</div>

